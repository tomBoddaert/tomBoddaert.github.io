<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/resources/profile-image.svg" as="image">
    <link rel="preload" href="/resources/main.css" as="style">
    <title>Projects - tomBoddaert</title>
    <meta name="title" content="Projects - tomBoddaert">
    <link rel="icon" type="image/svg+xml" href="/resources/profile-image.svg">
    <meta name="description" content="Tom Boddaert's Projects">
    <meta name="keywords" content="tomBoddaert, programming">
    <meta name="author" content="Tom Boddaert">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="language" content="English">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&family=Material+Icons+Outlined&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/resources/main.css">
    <script src="/resources/main.js" type="module"></script>
    <link rel="stylesheet" href="/resources/projects.css">
  </head>
  <body>
    <aside>
      <img id="ProfileImage" src="/resources/profile-image.svg" alt="Tom Boddaert's hexagonal logo">
      <span id="Name">Tom Boddaert</span>
      <nav>
        <a href="/">Home</a><a href="/about">About me</a><a href="/links">Links</a>
        <a href="https://github.com/tomboddaert">GitHub</a>
        <a href="/projects">Projects</a><a href="/contact">Contact</a>
      </nav>
    </aside>
    <main>
      <h1>Projects</h1>
      <script type="module">
        const observerElement = document.getElementById( 'Observer' );
        // For some reason, the JS LSP I'm using doesn't like regex literals in HTML
        const scriptRegex = new RegExp( '<!-- script -->' );

        const projectNames = (
        await fetch( '/projects/index' )
        .then( response => response.text() )
        ).split( /\s/ )
        .filter( entry => entry.length !== 0 );

        const url = new URL( window.location.href );
        const project = url.hash;
        if ( project === '' ) {
        activateObserver();
        } else {
        await loadProject( project.slice( 1 ) );
        }

        async function loadProject( projectName ) {
        const project = await fetch( `/projects/${ projectName }` )
        .then( response => response.text() );

        const projectElement = document.createElement( 'section' );
        projectElement.insertAdjacentHTML( 'afterBegin', project );

        observerElement.insertAdjacentElement( 'beforebegin', projectElement );

        if ( project.match( scriptRegex ) !== null )
        import( `/projects/resources/${ projectName }.js` )
        .then( script => {
        script.run?.call( projectElement );
        } );

        projectElement.setAttribute( 'data-project-name', projectName );
        }

        function activateObserver() {
        let nextProjectIndex = 0;

        const observer = new IntersectionObserver( async observation => {
        if ( observation.length === 0 || !observation.at( 0 ).isIntersecting )
        return;

        observer.unobserve( observerElement );

        const projectName = projectNames[ nextProjectIndex++ ];
        if ( !projectName )
        return;

        if ( nextProjectIndex !== 1 ) {
        const line = document.createElement( 'hr' );
        observerElement.insertAdjacentElement( 'beforebegin', line );
        }

        await loadProject( projectName );

        observer.observe( observerElement );
        } );
        observer.observe( observerElement );
        }
      </script>
      <hr id="Observer">
    </main>
  </body>
</html>